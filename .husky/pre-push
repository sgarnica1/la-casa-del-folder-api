#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

branch_name=$(git symbolic-ref --short HEAD 2>/dev/null || git rev-parse --short HEAD)

if [ -z "$branch_name" ]; then
  echo "❌ Could not determine branch name"
  exit 1
fi

protected_branches="main master develop"
for protected in $protected_branches; do
  if [ "$branch_name" = "$protected" ]; then
    echo "❌ Pushing to '$branch_name' branch is not allowed!"
    echo ""
    echo "Protected branches: $protected_branches"
    echo "Please create a feature branch and open a pull request instead."
    echo ""
    exit 1
  fi
done

if ! echo "$branch_name" | grep -qE "^(feature|fix|hotfix|chore|docs|refactor|test|perf|ci)/.+|^[a-z]+-[0-9]+-.+"; then
  echo "❌ Invalid branch name: $branch_name"
  echo ""
  echo "Branch names must follow one of these patterns:"
  echo "  - feature/description"
  echo "  - fix/description"
  echo "  - hotfix/description"
  echo "  - chore/description"
  echo "  - docs/description"
  echo "  - refactor/description"
  echo "  - test/description"
  echo "  - perf/description"
  echo "  - ci/description"
  echo "  - ticket-number-description (e.g., abc-123-fix-bug)"
  echo ""
  exit 1
fi
